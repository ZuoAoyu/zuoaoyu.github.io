<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=theme-color content="dark"><title>keras二分类问题: 影评是正面还是负面的 | 侠客</title><meta property="og:site_name" content="侠客"><meta property="og:title" content="keras二分类问题: 影评是正面还是负面的 | 侠客"><meta itemprop=name content="keras二分类问题: 影评是正面还是负面的 | 侠客"><meta name=twitter:title content="keras二分类问题: 影评是正面还是负面的 | 侠客"><meta name=application-name content="keras二分类问题: 影评是正面还是负面的 | 侠客"><meta name=twitter:card content="summary"><meta name=description content="工作、学习、生活、理想"><meta name=twitter:description content="工作、学习、生活、理想"><meta itemprop=description content="工作、学习、生活、理想"><meta property="og:description" content="工作、学习、生活、理想"><meta property="og:type" content="article"><meta property="article:publisher" content="Guanghao Zuo"><meta property="og:article:published_time" content="2023-05-05T10:42:00+0800"><meta property="article:published_time" content="2023-05-05T10:42:00+0800"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"keras二分类问题: 影评是正面还是负面的","author":{"@type":"Person","name":"Guanghao Zuo"},"datePublished":"2023-05-05","description":"","wordCount":1250,"mainEntityOfPage":"True","dateModified":"2023-05-05","publisher":{"@type":"Organization","name":"Guanghao Zuo","logo":{"@type":"imageObject","url":"https:\/\/o5o.me\/favicon.ico"}}}</script><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=stylesheet href=/sass/main.min.ab99ff095f832511e24ffb2fba2b51ad473b2f7e9301d674eba2c6c3a6e8bd81.css></head><script>(function(){const e="ThemeColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="ThemeColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.userColorScheme="dark":document.documentElement.dataset.userColorScheme="light"})()</script><body class=dark><nav class=navbar><div class=container><div class=flex><div><a class=brand href=/><img src=/favicon.ico>
侠客</a></div><div class=flex><a href=/articles/>Articles</a>
<button id=dark-mode-button><svg class="light" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform:rotate(360deg);-webkit-transform:rotate(360deg);transform:rotate(360deg)" viewBox="0 0 36 36"><path fill="#ffd983" d="M30.312.776C32 19 20 32 .776 30.312c8.199 7.717 21.091 7.588 29.107-.429C37.9 21.867 38.03 8.975 30.312.776z"/><path d="M30.705 15.915a1.163 1.163.0 101.643 1.641 1.163 1.163.0 00-1.643-1.641zm-16.022 14.38a1.74 1.74.0 000 2.465 1.742 1.742.0 100-2.465zm13.968-2.147a2.904 2.904.0 01-4.108.0 2.902 2.902.0 010-4.107 2.902 2.902.0 014.108.0 2.902 2.902.0 010 4.107z" fill="#ffcc4d"/><rect x="0" y="0" width="36" height="36" fill="rgba(0, 0, 0, 0)"/></svg><svg class="dark" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform:rotate(360deg);-webkit-transform:rotate(360deg);transform:rotate(360deg)" viewBox="0 0 36 36"><path fill="#ffd983" d="M16 2s0-2 2-2 2 2 2 2v2s0 2-2 2-2-2-2-2V2zm18 14s2 0 2 2-2 2-2 2h-2s-2 0-2-2 2-2 2-2h2zM4 16s2 0 2 2-2 2-2 2H2s-2 0-2-2 2-2 2-2h2zm5.121-8.707s1.414 1.414.0 2.828-2.828.0-2.828.0L4.878 8.708s-1.414-1.414.0-2.829c1.415-1.414 2.829.0 2.829.0l1.414 1.414zm21 21s1.414 1.414.0 2.828-2.828.0-2.828.0l-1.414-1.414s-1.414-1.414.0-2.828 2.828.0 2.828.0l1.414 1.414zm-.413-18.172s-1.414 1.414-2.828.0.0-2.828.0-2.828l1.414-1.414s1.414-1.414 2.828.0.0 2.828.0 2.828l-1.414 1.414zm-21 21s-1.414 1.414-2.828.0.0-2.828.0-2.828l1.414-1.414s1.414-1.414 2.828.0.0 2.828.0 2.828l-1.414 1.414zM16 32s0-2 2-2 2 2 2 2v2s0 2-2 2-2-2-2-2v-2z"/><circle fill="#ffd983" cx="18" cy="18" r="10"/><rect x="0" y="0" width="36" height="36" fill="rgba(0, 0, 0, 0)"/></svg></button></div></div></div></nav><main><div class=container><article><header class=article-header><div class=thumb><div><h1>keras二分类问题: 影评是正面还是负面的</h1><div class=post-meta><div>By Guanghao Zuo | <time>May 05, 2023</time>
| 6 minutes</div><div class=tags><a href=/tags/keras/>Keras</a>
<a href=/tags/%E4%BA%8C%E5%88%86%E7%B1%BB/>二分类</a></div></div></div></div></header></article><div class=article-post><p>所用环境为Colab.</p><h2 id=定义任务目标><a href=#%e5%ae%9a%e4%b9%89%e4%bb%bb%e5%8a%a1%e7%9b%ae%e6%a0%87 class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>定义任务目标</h2><p>拿到一些对电影的评论, 判断出来哪些评论是正面的, 哪些是负面的.</p><h2 id=数据收集><a href=#%e6%95%b0%e6%8d%ae%e6%94%b6%e9%9b%86 class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>数据收集</h2><h3 id=数据收集-1><a href=#%e6%95%b0%e6%8d%ae%e6%94%b6%e9%9b%86-1 class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>数据收集</h3><p>使用 IMDB 数据集.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 加载数据集(需联网)</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>tensorflow.keras.datasets</span> <span class=kn>import</span> <span class=n>imdb</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=n>train_data</span><span class=p>,</span> <span class=n>train_labels</span><span class=p>),</span> <span class=p>(</span><span class=n>test_data</span><span class=p>,</span> <span class=n>test_labels</span><span class=p>)</span> <span class=o>=</span> <span class=n>imdb</span><span class=o>.</span><span class=n>load_data</span><span class=p>(</span><span class=n>num_words</span><span class=o>=</span><span class=mi>10000</span><span class=p>)</span> <span class=c1># num_words=10000, 仅保留数据中前10000个最常出现的单词</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=数据可视化><a href=#%e6%95%b0%e6%8d%ae%e5%8f%af%e8%a7%86%e5%8c%96 class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>数据可视化</h4><p>建立对数据形状的感受.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 检查数据</span>
</span></span><span class=line><span class=cl><span class=n>train_data</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span><span class=err> </span><span class=n>train_labels</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span><span class=err> </span><span class=n>test_data</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span><span class=err> </span><span class=n>test_labels</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span><span class=err> </span><span class=n>train_data</span><span class=o>.</span><span class=n>dtype</span>
</span></span><span class=line><span class=cl><span class=c1># ((25000,), (25000,), (25000,), (25000,), dtype(&#39;O&#39;))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>type</span><span class=p>(</span><span class=n>train_data</span><span class=p>),</span><span class=err> </span><span class=nb>type</span><span class=p>(</span><span class=n>train_data</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span><span class=err> </span><span class=n>train_data</span><span class=o>.</span><span class=n>ndim</span>
</span></span><span class=line><span class=cl><span class=c1># (numpy.ndarray, list, 1)</span>
</span></span></code></pre></td></tr></table></div></div><p>看一下数据集里的数据到底长什么样子, 数据对应的标签是什么.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 查看第1条评论的前10个单词, 以及它的标签(正面还是负面)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>train_data</span><span class=p>[</span><span class=mi>0</span><span class=p>][:</span><span class=mi>10</span><span class=p>]</span> <span class=c1># 电影评论里的单词被转换为一个个数字.</span>
</span></span><span class=line><span class=cl><span class=c1># [1, 14, 22, 16, 43, 530, 973, 1622, 1385, 65]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>train_labels</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1># 1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 最长的一条电影评论的长度是多少</span>
</span></span><span class=line><span class=cl><span class=nb>max</span><span class=p>([</span><span class=nb>max</span><span class=p>(</span><span class=n>item</span><span class=p>)</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>train_data</span><span class=p>])</span> <span class=c1># 先得到每条评论的长度, 再得到长度的最大值</span>
</span></span></code></pre></td></tr></table></div></div><p>数据集里的评论被编码为了数字, 解码成正常文本看看.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>word_index</span><span class=err> </span><span class=o>=</span><span class=err> </span><span class=n>imdb</span><span class=o>.</span><span class=n>get_word_index</span><span class=p>()</span><span class=err> </span><span class=c1># word_index 是一个字典, 键是单词, 值是对应的一个整数.</span>
</span></span><span class=line><span class=cl><span class=n>word_index</span><span class=p>[</span><span class=s2>&#34;hello&#34;</span><span class=p>]</span> <span class=c1># hello这个单词对应的整数是4822</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>reverse_word_index</span><span class=err> </span><span class=o>=</span><span class=err> </span><span class=nb>dict</span><span class=p>([(</span><span class=n>value</span><span class=p>,</span><span class=err> </span><span class=n>key</span><span class=p>)</span><span class=err> </span><span class=k>for</span><span class=err> </span><span class=p>(</span><span class=n>key</span><span class=p>,</span><span class=err> </span><span class=n>value</span><span class=p>)</span><span class=err> </span><span class=ow>in</span><span class=err> </span><span class=n>word_index</span><span class=o>.</span><span class=n>items</span><span class=p>()])</span><span class=err> </span><span class=c1># 一个新字典, 键是一个整数, 值是该整数对应的单词</span>
</span></span><span class=line><span class=cl><span class=n>reverse_word_index</span><span class=p>[</span><span class=mi>4822</span><span class=p>]</span> <span class=c1># &#39;hello&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>decoded_review</span><span class=err> </span><span class=o>=</span><span class=err> </span><span class=s2>&#34; &#34;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=n>reverse_word_index</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>i</span><span class=err> </span><span class=o>-</span><span class=err> </span><span class=mi>3</span><span class=p>,</span><span class=err> </span><span class=s2>&#34;?&#34;</span><span class=p>)</span><span class=err> </span><span class=k>for</span><span class=err> </span><span class=n>i</span><span class=err> </span><span class=ow>in</span><span class=err> </span><span class=n>train_data</span><span class=p>[</span><span class=mi>0</span><span class=p>]])</span> <span class=c1># 把训练集中的第一条评论解码成正常文本. 索引减3是因为, 训练集里的单词对应的整数, 相比于字典, 都向右偏移了3.</span>
</span></span><span class=line><span class=cl><span class=n>decoded_review</span>
</span></span></code></pre></td></tr></table></div></div><p>解码出来的文本:</p><pre tabindex=0><code>? this film was just brilliant casting location scenery story direction everyone&#39;s really suited the part they played and you could just imagine being there robert ? is an amazing actor and now the same being director ? father came from the same scottish island as myself so i loved the fact there was a real connection with this film the witty remarks throughout the film were great it was just brilliant so much that i bought the film as soon as it was released for ? and would recommend it to everyone to watch and the fly fishing was amazing really cried at the end it was so sad and you know what they say if you cry at a film it must have been good and this definitely was also ? to the two little boy&#39;s that played the ? of norman and paul they were just brilliant children are often left out of the ? list i think because the stars that play them all grown up are such a big profile for the whole film but these children are amazing and should be praised for what they have done don&#39;t you think the whole story was so lovely because it was true and was someone&#39;s life after all that was shared with us all
</code></pre><p>很显然这是一条正面评论. 这条评论的标签是"1", 这时我们也清楚了, 标签为"1"代表该评论是正面的, 为"0"代表该评论是负面的.</p><h3 id=数据标注><a href=#%e6%95%b0%e6%8d%ae%e6%a0%87%e6%b3%a8 class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>数据标注</h3><p>已标注好</p><h3 id=数据清理><a href=#%e6%95%b0%e6%8d%ae%e6%b8%85%e7%90%86 class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>数据清理</h3><p>无需清理</p><h2 id=选择模型评估方法><a href=#%e9%80%89%e6%8b%a9%e6%a8%a1%e5%9e%8b%e8%af%84%e4%bc%b0%e6%96%b9%e6%b3%95 class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>选择模型评估方法</h2><h3 id=确定简单基准模型应能超越这个基准><a href=#%e7%a1%ae%e5%ae%9a%e7%ae%80%e5%8d%95%e5%9f%ba%e5%87%86%e6%a8%a1%e5%9e%8b%e5%ba%94%e8%83%bd%e8%b6%85%e8%b6%8a%e8%bf%99%e4%b8%aa%e5%9f%ba%e5%87%86 class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>确定简单基准(模型应能超越这个基准)</h3><p>如果为评论随机指定分类, 能分类正确的概率为50%, 因此建立的模型的分类正确率应该超过50%.</p><h3 id=评估方法选择><a href=#%e8%af%84%e4%bc%b0%e6%96%b9%e6%b3%95%e9%80%89%e6%8b%a9 class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>评估方法选择</h3><p>这里选择精度(accuracy)作为模型评估的指标. 精度, 即正确分类的图像所占比例.</p><p>怎样用? 构建好模型后, 在模型编译阶段, 将<code>model.compile()</code>的<code>metrics</code>参数值设定为<code>["accuracy"]</code></p><h2 id=数据预处理><a href=#%e6%95%b0%e6%8d%ae%e9%a2%84%e5%a4%84%e7%90%86 class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>数据预处理</h2><h3 id=数据向量化和规范化><a href=#%e6%95%b0%e6%8d%ae%e5%90%91%e9%87%8f%e5%8c%96%e5%92%8c%e8%a7%84%e8%8c%83%e5%8c%96 class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>数据向量化和规范化</h3><p>对文本列表进行multi-hot编码, 将其转换为由0和1组成的向量. 把每条评论都转换为一个10000维向量, 如果一个单词在该评论里出现, 就把该单词的索引(单词对应的那个整数)对应位置的元素设为1.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>import</span><span class=err> </span><span class=n>numpy</span><span class=err> </span><span class=k>as</span><span class=err> </span><span class=n>np</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>def</span><span class=err> </span><span class=n>vectorize_sequences</span><span class=p>(</span><span class=n>sequences</span><span class=p>,</span><span class=err> </span><span class=n>dimension</span><span class=o>=</span><span class=mi>10000</span><span class=p>):</span>
</span></span><span class=line><span class=cl><span class=err>  </span><span class=n>results</span><span class=err> </span><span class=o>=</span><span class=err> </span><span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=nb>len</span><span class=p>(</span><span class=n>sequences</span><span class=p>),</span><span class=err> </span><span class=n>dimension</span><span class=p>))</span><span class=err> </span><span class=c1># 创建一个零矩阵</span>
</span></span><span class=line><span class=cl><span class=err>  </span><span class=k>for</span><span class=err> </span><span class=n>i</span><span class=p>,</span><span class=err> </span><span class=n>sequence</span><span class=err> </span><span class=ow>in</span><span class=err> </span><span class=nb>enumerate</span><span class=p>(</span><span class=n>sequences</span><span class=p>):</span>
</span></span><span class=line><span class=cl><span class=err>    </span><span class=k>for</span><span class=err> </span><span class=n>j</span><span class=err> </span><span class=ow>in</span><span class=err> </span><span class=n>sequence</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=err>      </span><span class=n>results</span><span class=p>[</span><span class=n>i</span><span class=p>,</span><span class=err> </span><span class=n>j</span><span class=p>]</span><span class=err> </span><span class=o>=</span><span class=err> </span><span class=mf>1.</span>
</span></span><span class=line><span class=cl><span class=err>  </span><span class=k>return</span><span class=err> </span><span class=n>results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>x_train</span><span class=err> </span><span class=o>=</span><span class=err> </span><span class=n>vectorize_sequences</span><span class=p>(</span><span class=n>train_data</span><span class=p>)</span><span class=err> </span><span class=c1># 将训练数据向量化</span>
</span></span><span class=line><span class=cl><span class=n>x_test</span><span class=err> </span><span class=o>=</span><span class=err> </span><span class=n>vectorize_sequences</span><span class=p>(</span><span class=n>test_data</span><span class=p>)</span><span class=err> </span><span class=c1># 将测试数据向量化</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>y_train</span><span class=err> </span><span class=o>=</span><span class=err> </span><span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>train_labels</span><span class=p>)</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=s2>&#34;float32&#34;</span><span class=p>)</span><span class=err> </span><span class=c1># 将标签向量化</span>
</span></span><span class=line><span class=cl><span class=n>y_test</span><span class=err> </span><span class=o>=</span><span class=err> </span><span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>test_labels</span><span class=p>)</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=s2>&#34;float32&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>x_train</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span><span class=err> </span><span class=n>x_test</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span><span class=err> </span><span class=n>x_train</span><span class=o>.</span><span class=n>ndim</span>
</span></span><span class=line><span class=cl><span class=c1># ((25000, 10000), (25000, 10000), 2)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>x_train</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=c1># 第1条评论现在变成了什么样子</span>
</span></span><span class=line><span class=cl><span class=c1># array([0., 1., 1., ..., 0., 0., 0.])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>y_train</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span><span class=err> </span><span class=n>y_test</span><span class=o>.</span><span class=n>shape</span>
</span></span><span class=line><span class=cl><span class=c1># ((25000,), (25000,))</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=处理缺失值><a href=#%e5%a4%84%e7%90%86%e7%bc%ba%e5%a4%b1%e5%80%bc class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>处理缺失值</h3><p>不需要处理缺失值.</p><h3 id=数据划分-训练集-验证集-测试集><a href=#%e6%95%b0%e6%8d%ae%e5%88%92%e5%88%86-%e8%ae%ad%e7%bb%83%e9%9b%86-%e9%aa%8c%e8%af%81%e9%9b%86-%e6%b5%8b%e8%af%95%e9%9b%86 class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>数据划分: 训练集, 验证集, 测试集</h3><p>从训练集中分出一部分作为验证集.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>x_val</span><span class=err> </span><span class=o>=</span><span class=err> </span><span class=n>x_train</span><span class=p>[:</span><span class=mi>10000</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>partial_x_train</span><span class=err> </span><span class=o>=</span><span class=err> </span><span class=n>x_train</span><span class=p>[</span><span class=mi>10000</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>y_val</span><span class=err> </span><span class=o>=</span><span class=err> </span><span class=n>y_train</span><span class=p>[:</span><span class=mi>10000</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>partial_y_train</span><span class=err> </span><span class=o>=</span><span class=err> </span><span class=n>y_train</span><span class=p>[</span><span class=mi>10000</span><span class=p>:]</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=构建第一个模型><a href=#%e6%9e%84%e5%bb%ba%e7%ac%ac%e4%b8%80%e4%b8%aa%e6%a8%a1%e5%9e%8b class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>构建第一个模型</h2><h3 id=特征选择过滤没有信息量的特征-开发新特征><a href=#%e7%89%b9%e5%be%81%e9%80%89%e6%8b%a9%e8%bf%87%e6%bb%a4%e6%b2%a1%e6%9c%89%e4%bf%a1%e6%81%af%e9%87%8f%e7%9a%84%e7%89%b9%e5%be%81-%e5%bc%80%e5%8f%91%e6%96%b0%e7%89%b9%e5%be%81 class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>特征选择(过滤没有信息量的特征; 开发新特征)</h3><p>在本例中特征就是评论里编码后的单词了.</p><h3 id=选择架构><a href=#%e9%80%89%e6%8b%a9%e6%9e%b6%e6%9e%84 class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>选择架构</h3><p>两个中间层, 每层16个单元. 第三层输出标量预测值, 代表一条评论的情感类别(正面, 负面).</p><p>层1: Dense层, &ldquo;表示空间"的维数<code>units</code>为<code>16</code>, 激活函数<code>activation</code>为<code>relu</code>.</p><p>层2: Dense层, &ldquo;表示空间"的维数<code>units</code>为<code>16</code>, 激活函数<code>activation</code>为<code>softmax</code>.</p><p>层3: Dense层, &ldquo;表示空间"的维数<code>units</code>为<code>1</code>, 激活函数<code>activation</code>为<code>sigmoid</code>. 输出是一个介于0~1之间的概率值, 表示样本目标值等于"1"的可能性, 即评论为正面的可能性.</p><h3 id=训练配置损失函数-批量大小-学习率><a href=#%e8%ae%ad%e7%bb%83%e9%85%8d%e7%bd%ae%e6%8d%9f%e5%a4%b1%e5%87%bd%e6%95%b0-%e6%89%b9%e9%87%8f%e5%a4%a7%e5%b0%8f-%e5%ad%a6%e4%b9%a0%e7%8e%87 class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>训练配置(损失函数, 批量大小, 学习率)</h3><h4 id=优化器-optimizer><a href=#%e4%bc%98%e5%8c%96%e5%99%a8-optimizer class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>优化器 optimizer</h4><p>这里选<code>rmsprop</code></p><h4 id=损失函数-loss-function><a href=#%e6%8d%9f%e5%a4%b1%e5%87%bd%e6%95%b0-loss-function class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>损失函数 loss function</h4><p>这里选二元交叉熵损失函数<code>binary_crossentropy</code></p><h4 id=训练轮数><a href=#%e8%ae%ad%e7%bb%83%e8%bd%ae%e6%95%b0 class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>训练轮数</h4><p>这里训练20轮.</p><h4 id=数据批量大小><a href=#%e6%95%b0%e6%8d%ae%e6%89%b9%e9%87%8f%e5%a4%a7%e5%b0%8f class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>数据批量大小</h4><p>批量大小设为512.</p><h3 id=模型构建代码><a href=#%e6%a8%a1%e5%9e%8b%e6%9e%84%e5%bb%ba%e4%bb%a3%e7%a0%81 class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>模型构建代码</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>from</span><span class=err> </span><span class=n>tensorflow</span><span class=err> </span><span class=n>import</span><span class=err> </span><span class=n>keras</span>
</span></span><span class=line><span class=cl><span class=n>from</span><span class=err> </span><span class=n>tensorflow</span><span class=o>.</span><span class=n>keras</span><span class=err> </span><span class=n>import</span><span class=err> </span><span class=n>layers</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 构建模型</span>
</span></span><span class=line><span class=cl><span class=n>model</span><span class=err> </span><span class=o>=</span><span class=err> </span><span class=n>keras</span><span class=o>.</span><span class=n>Sequential</span><span class=p>([</span>
</span></span><span class=line><span class=cl><span class=err>  </span><span class=n>layers</span><span class=o>.</span><span class=n>Dense</span><span class=p>(</span><span class=mi>16</span><span class=p>,</span><span class=err> </span><span class=n>activation</span><span class=o>=</span><span class=s2>&#34;relu&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl><span class=err>  </span><span class=n>layers</span><span class=o>.</span><span class=n>Dense</span><span class=p>(</span><span class=mi>16</span><span class=p>,</span><span class=err> </span><span class=n>activation</span><span class=o>=</span><span class=s2>&#34;relu&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl><span class=err>  </span><span class=n>layers</span><span class=o>.</span><span class=n>Dense</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=err> </span><span class=n>activation</span><span class=o>=</span><span class=s2>&#34;sigmoid&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 编译模型</span>
</span></span><span class=line><span class=cl><span class=n>model</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=n>optimizer</span><span class=o>=</span><span class=s2>&#34;rmsprop&#34;</span><span class=p>,</span><span class=err> </span><span class=n>loss</span><span class=o>=</span><span class=s2>&#34;binary_crossentropy&#34;</span><span class=p>,</span><span class=err> </span><span class=n>metrics</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;accuracy&#34;</span><span class=p>])</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=拟合模型><a href=#%e6%8b%9f%e5%90%88%e6%a8%a1%e5%9e%8b class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>拟合模型</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>history</span><span class=err> </span><span class=o>=</span><span class=err> </span><span class=n>model</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>partial_x_train</span><span class=p>,</span><span class=err> </span><span class=n>partial_y_train</span><span class=p>,</span><span class=err> </span><span class=n>epochs</span><span class=o>=</span><span class=mi>20</span><span class=p>,</span><span class=err> </span><span class=n>batch_size</span><span class=o>=</span><span class=mi>512</span><span class=p>,</span> <span class=n>validation_data</span><span class=o>=</span><span class=p>(</span><span class=n>x_val</span><span class=p>,</span> <span class=n>y_val</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><p>输出:</p><pre tabindex=0><code>Epoch 1/20 30/30 [==============================] - 3s 77ms/step - loss: 0.5066 - accuracy: 0.7891 - val_loss: 0.3772 - val_accuracy: 0.8726 
Epoch 2/20 30/30 [==============================] - 1s 40ms/step - loss: 0.3095 - accuracy: 0.8973 - val_loss: 0.3270 - val_accuracy: 0.8708 
Epoch 3/20 30/30 [==============================] - 1s 41ms/step - loss: 0.2321 - accuracy: 0.9209 - val_loss: 0.2788 - val_accuracy: 0.8913 
Epoch 4/20 30/30 [==============================] - 1s 44ms/step - loss: 0.1899 - accuracy: 0.9361 - val_loss: 0.2989 - val_accuracy: 0.8797 
Epoch 5/20 30/30 [==============================] - 1s 49ms/step - loss: 0.1579 - accuracy: 0.9477 - val_loss: 0.2835 - val_accuracy: 0.8862 
Epoch 6/20 30/30 [==============================] - 2s 58ms/step - loss: 0.1358 - accuracy: 0.9569 - val_loss: 0.3212 - val_accuracy: 0.8725 
Epoch 7/20 30/30 [==============================] - 2s 65ms/step - loss: 0.1184 - accuracy: 0.9631 - val_loss: 0.3048 - val_accuracy: 0.8793 
Epoch 8/20 30/30 [==============================] - 2s 61ms/step - loss: 0.1000 - accuracy: 0.9695 - val_loss: 0.3149 - val_accuracy: 0.8811 
Epoch 9/20 30/30 [==============================] - 1s 41ms/step - loss: 0.0861 - accuracy: 0.9749 - val_loss: 0.3366 - val_accuracy: 0.8834 
Epoch 10/20 30/30 [==============================] - 2s 56ms/step - loss: 0.0746 - accuracy: 0.9780 - val_loss: 0.3619 - val_accuracy: 0.8708 
Epoch 11/20 30/30 [==============================] - 2s 55ms/step - loss: 0.0660 - accuracy: 0.9827 - val_loss: 0.3676 - val_accuracy: 0.8783 
Epoch 12/20 30/30 [==============================] - 2s 52ms/step - loss: 0.0575 - accuracy: 0.9855 - val_loss: 0.3926 - val_accuracy: 0.8737 
Epoch 13/20 30/30 [==============================] - 1s 44ms/step - loss: 0.0465 - accuracy: 0.9896 - val_loss: 0.4083 - val_accuracy: 0.8760 
Epoch 14/20 30/30 [==============================] - 1s 40ms/step - loss: 0.0418 - accuracy: 0.9895 - val_loss: 0.4366 - val_accuracy: 0.8732 
Epoch 15/20 30/30 [==============================] - 1s 40ms/step - loss: 0.0373 - accuracy: 0.9906 - val_loss: 0.4559 - val_accuracy: 0.8735 
Epoch 16/20 30/30 [==============================] - 2s 73ms/step - loss: 0.0281 - accuracy: 0.9953 - val_loss: 0.4732 - val_accuracy: 0.8741 
Epoch 17/20 30/30 [==============================] - 2s 53ms/step - loss: 0.0269 - accuracy: 0.9951 - val_loss: 0.5042 - val_accuracy: 0.8730 
Epoch 18/20 30/30 [==============================] - 2s 54ms/step - loss: 0.0247 - accuracy: 0.9955 - val_loss: 0.5203 - val_accuracy: 0.8721 
Epoch 19/20 30/30 [==============================] - 2s 54ms/step - loss: 0.0180 - accuracy: 0.9980 - val_loss: 0.5411 - val_accuracy: 0.8714 
Epoch 20/20 30/30 [==============================] - 1s 43ms/step - loss: 0.0154 - accuracy: 0.9983 - val_loss: 0.5657 - val_accuracy: 0.8704
</code></pre><p>可以看到, 训练了20轮后, 虽然在训练集上的精度达到了<code>0.9983</code>, 但在验证集上, 精度却只有<code>0.8704</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>history_dict</span><span class=err> </span><span class=o>=</span><span class=err> </span><span class=n>history</span><span class=o>.</span><span class=n>history</span><span class=err> </span><span class=c1># 一个字典, 键是&#34;指标&#34;; 值是列表, 指标在每轮训练时的值.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>history_dict</span><span class=o>.</span><span class=n>keys</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1># dict_keys([&#39;loss&#39;, &#39;accuracy&#39;, &#39;val_loss&#39;, &#39;val_accuracy&#39;])</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=可视化拟合结果><a href=#%e5%8f%af%e8%a7%86%e5%8c%96%e6%8b%9f%e5%90%88%e7%bb%93%e6%9e%9c class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>可视化拟合结果</h3><h4 id=绘制训练损失和验证损失><a href=#%e7%bb%98%e5%88%b6%e8%ae%ad%e7%bb%83%e6%8d%9f%e5%a4%b1%e5%92%8c%e9%aa%8c%e8%af%81%e6%8d%9f%e5%a4%b1 class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>绘制训练损失和验证损失</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>history_dict</span> <span class=o>=</span> <span class=n>history</span><span class=o>.</span><span class=n>history</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>loss_values</span> <span class=o>=</span> <span class=n>history_dict</span><span class=p>[</span><span class=s2>&#34;loss&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>val_loss_values</span> <span class=o>=</span> <span class=n>history_dict</span><span class=p>[</span><span class=s2>&#34;val_loss&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>epochs</span> <span class=o>=</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>loss_values</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>epochs</span><span class=p>,</span> <span class=n>loss_values</span><span class=p>,</span> <span class=s2>&#34;bo&#34;</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s2>&#34;Training loss&#34;</span><span class=p>)</span> <span class=c1># &#34;bo&#34;表示蓝色圆点</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>epochs</span><span class=p>,</span> <span class=n>val_loss_values</span><span class=p>,</span> <span class=s2>&#34;b&#34;</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s2>&#34;Validation loss&#34;</span><span class=p>)</span> <span class=c1># &#34;b&#34;表示蓝色实线</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s2>&#34;Training and validation loss&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s2>&#34;Epochs&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s2>&#34;Loss&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>legend</span><span class=p>()</span> <span class=c1># 用于为图表添加图例</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=/2023-05-05/20230505154515.png alt width=567 height=455></p><h4 id=绘制训练精度和验证精度><a href=#%e7%bb%98%e5%88%b6%e8%ae%ad%e7%bb%83%e7%b2%be%e5%ba%a6%e5%92%8c%e9%aa%8c%e8%af%81%e7%b2%be%e5%ba%a6 class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>绘制训练精度和验证精度</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># import matplotlib.pyplot as plt</span>
</span></span><span class=line><span class=cl><span class=c1># history_dict = history.history</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>clf</span><span class=p>()</span> <span class=c1># 清空图像</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>acc</span> <span class=o>=</span> <span class=n>history_dict</span><span class=p>[</span><span class=s2>&#34;accuracy&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>val_acc</span> <span class=o>=</span> <span class=n>history_dict</span><span class=p>[</span><span class=s2>&#34;val_accuracy&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># epochs = range(1, len(loss_values) + 1)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>epochs</span><span class=p>,</span> <span class=n>acc</span><span class=p>,</span> <span class=s2>&#34;bo&#34;</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s2>&#34;Training acc&#34;</span><span class=p>)</span> <span class=c1># &#34;bo&#34;表示蓝色圆点</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>epochs</span><span class=p>,</span> <span class=n>val_acc</span><span class=p>,</span> <span class=s2>&#34;b&#34;</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s2>&#34;Validation acc&#34;</span><span class=p>)</span> <span class=c1># &#34;b&#34;表示蓝色实线</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s2>&#34;Training and validation accuracy&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s2>&#34;Epochs&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s2>&#34;Accuracy&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>legend</span><span class=p>()</span> <span class=c1># 用于为图表添加图例</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=/2023-05-05/20230505155032.png alt width=576 height=455></p><p>从图中看出, 模型在训练到第4轮后, 开始出现过拟合的现象.</p><h2 id=改进模型><a href=#%e6%94%b9%e8%bf%9b%e6%a8%a1%e5%9e%8b class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>改进模型</h2><h3 id=让模型在训练4轮后停止><a href=#%e8%ae%a9%e6%a8%a1%e5%9e%8b%e5%9c%a8%e8%ae%ad%e7%bb%834%e8%bd%ae%e5%90%8e%e5%81%9c%e6%ad%a2 class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>让模型在训练4轮后停止</h3><p>因为模型在训练到第4轮后就开始过拟合, 因此让模型训练4轮, 之后再次评估模型.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 注意, 这次拟合时没有再从训练集中分出一部分做验证, 而是全部用来训练</span>
</span></span><span class=line><span class=cl><span class=n>history</span><span class=err> </span><span class=o>=</span><span class=err> </span><span class=n>model</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>x_train</span><span class=p>,</span><span class=err> </span><span class=n>y_train</span><span class=p>,</span><span class=err> </span><span class=n>epochs</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span><span class=err> </span><span class=n>batch_size</span><span class=o>=</span><span class=mi>512</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=评价模型><a href=#%e8%af%84%e4%bb%b7%e6%a8%a1%e5%9e%8b class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>评价模型</h2><p>前面选择精度(accuracy)作为模型评估的指标, 因此在对模型效果进行评价时, 使用模型在整个测试集上的平均精度.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>test_loss</span><span class=p>,</span><span class=err> </span><span class=n>test_acc</span><span class=err> </span><span class=o>=</span><span class=err> </span><span class=n>model</span><span class=o>.</span><span class=n>evaluate</span><span class=p>(</span><span class=n>x_test</span><span class=p>,</span><span class=err> </span><span class=n>y_test</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;测试精度: </span><span class=si>{</span><span class=n>test_acc</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 782/782 [==============================] - 2s 3ms/step - loss: 0.4298 - accuracy: 0.8632 </span>
</span></span><span class=line><span class=cl><span class=n>测试精度</span><span class=p>:</span> <span class=mf>0.8631600141525269</span>
</span></span></code></pre></td></tr></table></div></div><p>可以看到, 模型在测试集上的精度为0.8632, 表明模型还应进一步改进..</p><h2 id=利用模型进行预测><a href=#%e5%88%a9%e7%94%a8%e6%a8%a1%e5%9e%8b%e8%bf%9b%e8%a1%8c%e9%a2%84%e6%b5%8b class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>利用模型进行预测</h2><p>拿到一条评论, 对它像在上面那样把它编码为一个由0和1组成的向量, 然后用<code>model.predict()</code>进行预测.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>predictions</span><span class=err> </span><span class=o>=</span><span class=err> </span><span class=n>model</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>x_test</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>predic_result</span><span class=err> </span><span class=o>=</span><span class=err> </span><span class=p>[</span><span class=mi>0</span><span class=err> </span><span class=k>if</span><span class=err> </span><span class=n>item</span><span class=err> </span><span class=o>&lt;</span><span class=err> </span><span class=mf>0.5</span><span class=err> </span><span class=k>else</span><span class=err> </span><span class=mi>1</span><span class=err> </span><span class=k>for</span><span class=err> </span><span class=n>item</span><span class=err> </span><span class=ow>in</span><span class=err> </span><span class=n>predictions</span><span class=p>[:</span><span class=mi>10</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=n>predic_result</span><span class=p>[:</span><span class=mi>10</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1># 预测值 [0, 1, 0, 1, 1, 1, 1, 0, 1, 1]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>list</span><span class=p>(</span><span class=n>y_test</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=mi>10</span><span class=p>]</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>int</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=c1># 实际值 [0, 1, 1, 0, 1, 1, 1, 0, 0, 1]</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=部署模型><a href=#%e9%83%a8%e7%bd%b2%e6%a8%a1%e5%9e%8b class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>部署模型</h2><p>不部署.</p></div></div><div class=container><nav class="flex container suggested"><a rel=prev href=/post/keras_case_mnist_handwriting_digits_recognition/ title="Previous post (older)"><span>Previous</span>
keras实现手写数字识别</a></nav></div><div class=container></div><div class=container><div class=post-comment><div id=vcomments></div><script src=//unpkg.com/valine/dist/Valine.min.js></script>
<script type=text/javascript>new Valine({el:"#vcomments",appId:"aodxhFvcnQZhByjhPdSxKzWH-gzGzoHsz",appKey:"JbXEtUPYPmhJ285n8cIoAnIn",placeholder:"说点什么吧...",visitor:"true"})</script></div></div></main></main><footer class="footer flex"><section class=container><nav class=footer-links><a href=/index.xml>RSS</a></nav></section><script defer src=/ts/features.706a523ba43e6d0427c7fdf2b9d05dbd0920d3f12942b453690b495cb2522743.js data-enable-footnotes=true></script></footer></body></html>